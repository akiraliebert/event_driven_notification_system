# üì¨ Event-Driven Notification System

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ **Kafka**, **Celery** –∏ **Redis**.
### –ü—Ä–æ–µ–∫—Ç –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è –Ω–µ –∫–∞–∫ "–ø—Ä–æ—Å—Ç–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞", –∞ –∫–∞–∫ **–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è production-grade event-driven —Å–∏—Å—Ç–µ–º—ã** ‚Äî —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π, –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏, rate limiting –∏ –ø–æ–ª–Ω—ã–º observability.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

- ### **–ú—É–ª—å—Ç–∏–∫–∞–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (Email, SMS, Push)

- ### **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî —Å–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Kafka

- ### **–ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏** ‚Äî at-least-once —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

- ### **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è** ‚Äî —Å—Ä–æ—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏

- ### **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî retry —Å exponential backoff, dead letter –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫

- ### **Rate limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ Redis sliding window

---

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.12**

- **Flask** ‚Äî HTTP API (Event Gateway)

- **Kafka** ‚Äî —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π, at-least-once delivery

- **Celery** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏

- **Redis** ‚Äî –±—Ä–æ–∫–µ—Ä Celery + rate limiting (sliding window)

- **PostgreSQL 16** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —à–∞–±–ª–æ–Ω–æ–≤, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

- **SQLAlchemy 2.0** ‚Äî ORM —Å mapped_column –∏ DeclarativeBase

- **Alembic** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ + seed –¥–∞–Ω–Ω—ã—Ö

- **Pydantic v2** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- **Docker / Docker Compose** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è 9 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

- **pytest / testcontainers** ‚Äî unit + e2e —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### üèóÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **event-driven –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤** —Å —á—ë—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

```
Webhook/API ‚îÄ‚îÄ‚ñ∫ [Event Gateway] ‚îÄ‚îÄ‚ñ∫ Kafka ‚îÄ‚îÄ‚ñ∫ [Notification Service] ‚îÄ‚îÄ‚ñ∫ Celery ‚îÄ‚îÄ‚ñ∫ [Delivery Workers]
                                      ‚îÇ                                                    ‚îÇ
                                      ‚îÇ                                               Redis (rate limit)
                                      ‚ñº
                              [Analytics Service] ‚îÄ‚îÄ‚ñ∫ PostgreSQL
```

### üì¶ –°–µ—Ä–≤–∏—Å—ã

- ### **Event Gateway** ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è payload –ø–æ Pydantic-—Å—Ö–µ–º–∞–º, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Kafka

- ### **Notification Service** ‚Äî Kafka consumer: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, preferences, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —à–∞–±–ª–æ–Ω–æ–≤, dispatch –≤ Celery

- ### **Delivery Workers** ‚Äî Celery workers: –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, retry —Å backoff, rate limiting, —Å—Ç–∞—Ç—É—Å-—Ä–µ–ø–æ—Ä—Ç–∏–Ω–≥

- ### **Shared** ‚Äî –æ–±—â–∏–π –ø–∞–∫–µ—Ç: enums, —Å–æ–±—ã—Ç–∏—è, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –º–æ–¥–µ–ª–∏ –ë–î, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

## üß© –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- ### –°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Kafka** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP-–≤—ã–∑–æ–≤–æ–≤

- ### –ö–∞–∂–¥—ã–π consumer **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω** ‚Äî –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `event_id`, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞

- ### –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ `user_id` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—è –ø–æ—Ä—è–¥–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- ### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `flush()` –≤–º–µ—Å—Ç–æ `commit()` ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω **Unit of Work**

- ### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ **pydantic-settings** ‚Äî —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ env vars, –¥–µ—Ñ–æ–ª—Ç—ã –¥–ª—è dev

- ### –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚Äî **Jinja2 —Å StrictUndefined**, seed —á–µ—Ä–µ–∑ Alembic –º–∏–≥—Ä–∞—Ü–∏—é

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ shared/                          # –û–±—â–∏–π –ø–∞–∫–µ—Ç ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ src/shared/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enums.py                 # EventType, Channel, Priority, NotificationStatus
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                # KafkaConfig, RedisConfig, PostgresConfig
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events/                  # EventMetadata, Payload-–º–æ–¥–µ–ª–∏, parse_event()
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db/                      # Models, Repositories, Engine, JSONBCompatible
‚îÇ   ‚îî‚îÄ‚îÄ alembic/                     # –ú–∏–≥—Ä–∞—Ü–∏–∏ + seed 9 —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ event_gateway/               # Flask API ‚Üí Kafka producer
‚îÇ   ‚îú‚îÄ‚îÄ notification_service/        # Kafka consumer ‚Üí Celery dispatch
‚îÇ   ‚îî‚îÄ‚îÄ delivery_worker/             # Celery worker ‚Üí –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ tests/integration/               # E2E —á–µ—Ä–µ–∑ testcontainers
‚îú‚îÄ‚îÄ scripts/demo.py                  # –î–µ–º–æ-—Å–∫—Ä–∏–ø—Ç
‚îî‚îÄ‚îÄ docker-compose.yml               # 9 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, healthchecks, init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```

> –í—Å–µ –ø–∞–∫–µ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `src/` layout. Shared —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ editable dependency –≤ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ **uv workspace**.

---

# ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

- ### 3 –¥–æ–º–µ–Ω–∞: `user.registered`, `order.completed`, `payment.failed`

- ### –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ payload

- ### –§–∞–±—Ä–∏–∫–∞ `parse_event()` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥ –ø–æ `event_type`

- ### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–µ: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π payload –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ Kafka

---

## üîî –î–æ—Å—Ç–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- ### 3 –∫–∞–Ω–∞–ª–∞: **Email**, **SMS**, **Push**

- ### 9 —à–∞–±–ª–æ–Ω–æ–≤ Jinja2 (3 event_type √ó 3 channel), seed —á–µ—Ä–µ–∑ Alembic

- ### 4 —É—Ä–æ–≤–Ω—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: `critical` ‚Üí `high` ‚Üí `normal` ‚Üí `low`

- ### Celery —Å **4 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏** ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏

- ### –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —Å **ProviderRegistry** ‚Äî –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å stub –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

## üõ°Ô∏è –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

- ### **Retry —Å exponential backoff**: 1 –º–∏–Ω ‚Üí 5 –º–∏–Ω ‚Üí 15 –º–∏–Ω (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)

- ### **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –¥—É–±–ª–∏–∫–∞—Ç Kafka-—Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- ### **Rate limiting**: Redis sliding window per-channel ‚Äî –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

- ### **Dead letter**: –ø–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ ‚Äî —Å—Ç–∞—Ç—É—Å `failed`, —Å–æ–±—ã—Ç–∏–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞

- ### **Quiet hours**: –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å —É—á—ë—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è

- ### –í—ã–±–æ—Ä –∫–∞–Ω–∞–ª–æ–≤: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- ### Quiet hours: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏—Ö–∏—Ö —á–∞—Å–æ–≤ —Å —É—á—ë—Ç–æ–º —Ç–∞–π–º–∑–æ–Ω—ã

- ### –û—Ç–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üê≥ Docker Compose –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- ### **9 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ `depends_on` + healthchecks

- ### **Init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**: `db-migrate` (Alembic) –∏ `kafka-init` (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤)

- ### **–û–¥–∏–Ω `docker compose up`** ‚Äî –∏ –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –†–æ–ª—å |
|-----------|------|
| event-gateway | Flask API |
| notification-service | Kafka consumer + Celery producer |
| delivery-worker | Celery worker |
| db-migrate | Init: Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ + seed |
| kafka-init | Init: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ |
| kafka + zookeeper | –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π |
| redis | –ë—Ä–æ–∫–µ—Ä Celery + rate limiting |
| postgres | –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üóÇÔ∏è –î–≤–∞ —É—Ä–æ–≤–Ω—è —Ç–µ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º –æ—Ö–≤–∞—Ç–æ–º:

```
tests/
‚îú‚îÄ‚îÄ shared/tests/              # 78 unit-—Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ services/*/tests/          # 66 unit-—Ç–µ—Å—Ç–æ–≤ (3 —Å–µ—Ä–≤–∏—Å–∞)
‚îî‚îÄ‚îÄ tests/integration/         # 10 e2e-—Ç–µ—Å—Ç–æ–≤
```

## ‚úÖ –ü–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏

- ### Pydantic-–º–æ–¥–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –∏ payload-–æ–≤

- ### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env vars, –¥–µ—Ñ–æ–ª—Ç—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è)

- ### SQLAlchemy-–º–æ–¥–µ–ª–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

- ### Flask API (event gateway)

- ### Kafka consumer –∏ EventHandler

- ### Celery tasks, rate limiter, status publisher

- ### **E2E —á–µ—Ä–µ–∑ testcontainers**: –ø–æ–ª–Ω—ã–π flow HTTP ‚Üí Kafka ‚Üí DB ‚Üí Celery ‚Üí DELIVERED

## üî¨ E2E-—Å—Ü–µ–Ω–∞—Ä–∏–∏ (testcontainers)

- ### Full flow ‚Äî 3 —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π, –æ—Ç HTTP –¥–æ —Å—Ç–∞—Ç—É—Å–∞ DELIVERED

- ### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî –¥—É–±–ª–∏–∫–∞—Ç Kafka-—Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–µ–π

- ### User preferences ‚Äî –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- ### Retry on failure ‚Äî provider fail ‚Üí attempts++, –∏—Å—á–µ—Ä–ø–∞–Ω–∏–µ ‚Üí FAILED

- ### Priority ordering ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

> ### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–¥–Ω–∏–º–∞—é—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ Kafka, PostgreSQL –∏ Redis** —á–µ—Ä–µ–∑ testcontainers ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –º–æ–∫–æ–≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫
```bash
docker compose up --build
```

### –î–µ–º–æ (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π)
```bash
python scripts/demo.py
```

### Unit-—Ç–µ—Å—Ç—ã
```bash
# Shared
uv run --project shared --extra test pytest shared/tests/ -v

# Event Gateway
uv run --project services/event_gateway --extra test pytest services/event_gateway/tests/ -v

# Notification Service
uv run --project services/notification_service --extra test pytest services/notification_service/tests/ -v

# Delivery Worker
uv run --project services/delivery_worker --extra test pytest services/delivery_worker/tests/ -v
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
uv run --extra integration-test pytest tests/integration/ -v
```

---

## üí™ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞

- ### **Production-grade –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –Ω–µ —É—á–µ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –∞ —Å–∏—Å—Ç–µ–º–∞, –≥–æ—Ç–æ–≤–∞—è –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏, rate limiting, retry, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

- ### **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤** ‚Äî –æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Kafka, –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

- ### **Honest testing** ‚Äî e2e-—Ç–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ —á–µ—Ä–µ–∑ testcontainers, –∞ –Ω–µ –Ω–∞ –º–æ–∫–∞—Ö; 154 —Ç–µ—Å—Ç–∞ —Å—É–º–º–∞—Ä–Ω–æ

- ### **–ú–æ–Ω–æ—Ä–µ–ø–æ —Å uv workspace** ‚Äî –µ–¥–∏–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, shared-–ø–∞–∫–µ—Ç –∫–∞–∫ editable dependency, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ —Å–±–æ—Ä–∫–∏

- ### **–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π rate limiting** ‚Äî Redis sliding window per-channel, –∞ –Ω–µ –Ω–∞–∏–≤–Ω—ã–π —Å—á—ë—Ç—á–∏–∫

- ### **Quiet hours —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏** ‚Äî –Ω–µ "—Ñ–∏—á–∞ –¥–ª—è –≥–∞–ª–æ—á–∫–∏", –∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å `datetime` –∏ `timezone`

- ### **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** ‚Äî `ProviderRegistry` + ABC, –∑–∞–º–µ–Ω–∞ stub –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ –≤ —Ä–µ–µ—Å—Ç—Ä–µ

- ### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥** ‚Äî `docker compose up` –ø–æ–¥–Ω–∏–º–∞–µ—Ç 9 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º, –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏ seed –¥–∞–Ω–Ω—ã–º–∏

---

## üîÆ –ß—Ç–æ –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏—Ç—å –¥–∞–ª—å—à–µ

### –ü—Ä–æ–µ–∫—Ç –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω **—Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º**:

- #### Analytics Service ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –¥–æ—Å—Ç–∞–≤–∫–∏

- #### Observability ‚Äî Prometheus metrics, distributed tracing

- #### –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã ‚Äî SendGrid, Twilio, Firebase

- #### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî Kafka consumer groups, Celery autoscaling

- #### Admin UI ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

- #### Dead Letter Queue ‚Äî UI –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ failed —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## üèÅ –ò—Ç–æ–≥

### –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî –Ω–µ "–µ—â—ë –æ–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π", –∞:

- #### –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **event-driven –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**

- #### –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å **–≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏** –∏ **–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é**

- #### –ø–æ–Ω–∏–º–∞–Ω–∏—è trade-offs –º–µ–∂–¥—É **—Å–ª–æ–∂–Ω–æ—Å—Ç—å—é –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é**

- #### —É–º–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç—å **–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

> #### –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–º–µ–Ω–µ dev-stub –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –≤—ã—Ö–æ–¥—É –≤ production.
